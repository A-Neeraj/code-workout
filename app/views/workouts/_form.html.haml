= javascript_tag do
  window.codeworkout = window.codeworkout || {}
  window.codeworkout.lti_launch = "#{@lti_launch}"

.row
  .col-xs-9.alert-msg#alerts{style: 'display: none;'}
.form-horizontal
  %h4.text-danger '*' indicates a required field.
  .form-group
    = label_tag :name, 'Name *', class: 'control-label col-xs-2'
    .col-lg-7.col-md-6.col-xs-7
      = text_field_tag :name, nil, id: 'wo-name', class: 'form-control', maxlength: 50,
        placeholder: 'e.g. Recursion exercises', value: @workout.present? ? @workout.name : '',
        data: { old_name: @workout.present? ? @workout.name : '' }
    .row
      .col-xs-offset-2.col-lg-7.col-md-6.col-xs-7.alert-msg#clone-msg{ style: 'display: none;' }
        You do not have permission to edit this workout. If you put in a new name, we can create a clone with your
        new settings.
  .form-group
    = label_tag :description, 'Description', class: 'control-label col-xs-2'
    .col-lg-7.col-md-6.col-xs-7
      %textarea#description{ placeholder: '(optional) Exercise explanation, given after submission',
        rows: 2, class: 'form-control richtexteditor', value: @workout.present? ? @workout.name : '' }
  .ex-area.form-group
    = label_tag :ex_list, 'Exercises *', class: 'control-label col-xs-2'
    .col-lg-7.col-md-6.col-xs-7
      .empty-msg.alert-msg{ style: "display: #{@workout.andand.exercise_workouts.any? ? 'none;' : 'block;'}" }
        - if @lti_launch
          Use the search bar above the form to find exercises.
        - else
          Use the column on the left to find exercises.

      %ul.list-group#ex-list{ style: "display: #{@workout.andand.exercise_workouts.any? ? 'block;' : 'none;'}",
        data: { exercises: "#{@exercises.to_json}" } }
  .form-group
    = label_tag :policy_select, 'Policy', class: 'control-label col-xs-1'
    .col-xs-2
      = collection_select nil, nil, WorkoutPolicy.all, :id, :name, { prompt: 'Select' },
      { id: 'policy-select', class: 'form-control input-sm' }
    = label_tag :time_limit, 'Time', class: 'control-label col-xs-1'
    .col-xs-3
      %input#time-limit.form-control.input-sm.input{ type: 'number', min: '0',
        placeholder: 'Leave blank for no time limit.', value: @time_limit ? "#{@time_limit}" : '' }

  .form-group
    = label_tag :is_public, 'Public?', class: 'control-label col-xs-2'
    .col-xs-1
      .checkbox
        = check_box_tag 'is-public', 'is_public', true, id: 'is-public'

  .form-group
    %p.lead Add to Course Offerings
    .col-lg-9.col-md-6.col-xs-9
      %table#workout-offering-fields.table{ data: { can_update: "#{@can_update}" } }
        %thead
          %tr
            %th Course Offering
            %th Opens On
            %th Due Date
            %th Accepts Until
            %th Publish?
            %th Student Extensions
            %th Remove
        %tbody
          - if @workout_offerings.blank?
            = render partial: 'workout_offering_fields', locals: { removable: false, disabled: false,
              workout_offering: nil }
          - else
            - @workout_offerings.each do |offering|
              = render partial: 'workout_offering_fields', locals: { removable: true, disabled: true,
                workout_offering: offering }
  .form-group
    = button_tag type: 'button', id: 'add-offering', class: 'btn btn-success btn-sm' do
      %i.fa.fa-plus{ style: 'padding-right 5px;' }
      Add to Course Offering

  .form-group#extensions{ style: 'display: none;', data: { student_extensions: "#{@student_extensions.to_json}" } }
    %p.lead Student Extensions
    .col-lg-9.col-md-6.col-xs-9
      %table#student-extension-fields.table
        %thead
          %tr
            %th Course Offering
            %th Student
            %th Opens On
            %th Due Date
            %th Accepts Until
            %th Time Limit
            %th Remove
        %tbody

  .form-group
    %button#btn-submit-wo.btn.btn-primary Submit
    = link_to 'Back', workouts_path

  %table#add-offering-form{ style: 'display: none;' }
    %tbody
      = render partial: 'workout_offering_fields', locals: { removable: false, disabled: false, workout_offering: nil }

  #extension-modal.modal.fade{role: 'dialog', tabindex: '-1' }
    .modal-dialog.modal-lg{ style: 'overflow-y: scroll; max-height:85% margin-top: 50px; margin-bottom:50px;' }
      .modal-content
        .modal-header
          %p.lead#modal-header
        .modal-body
          .form-group
            .col-xs-10
              = text_field_tag 'terms', nil, placeholder: 'e.g John Smith or jsmith9@vt.edu or john. Blank for all students.',
                class: 'form-control'
            .col-xs-2
              = button_tag 'Search', id: 'btn-student-search', class: 'btn'
          #student-search-results
            #msg
              No results yet
            #results-area
              .list-group#results
